  <script>
    /**
     * Bootstraps the DUIX avatar page.
     * 1. Reads `sign` & `conversationId` from the query‑string.
     * 2. Waits for the SDK global (window.DUIX) to appear.
     * 3. Calls DUIX.init and renders into #duix-container.
     */

    (() => {
      // ---------------- helpers ----------------
      const qs = (k) => new URLSearchParams(location.search).get(k);

      const sign           = qs('sign');
      const conversationId = qs('conversationId');

      // quick validation ‑‑ bail early if URL is wrong
      if (!sign || !conversationId) {
        document.body.textContent = 'Missing “sign” or “conversationId” in the URL.';
        return;
      }

      // ---------------- wait for SDK ----------------
      function waitForSdk(retries = 20) {
        return new Promise((resolve, reject) => {
          const check = () => {
            const sdk = window.DUIX;                // the SDK attaches here (uppercase)
            if (sdk && typeof sdk.init === 'function') {
              return resolve(sdk);
            }
            if (retries-- === 0) {
              return reject(new Error('DUIX SDK failed to load – check network tab'));
            }
            setTimeout(check, 250);                 // keep polling every 250 ms
          };
          check();
        });
      }

      // ---------------- main flow ----------------
      (async () => {
        try {
          const duix = await waitForSdk();

          await duix.init({
            appId:  '1377185422953811968',
            appKey: '4f3725b2-7d48-4ea7-8640-d1a11eb00f8c',

            sign,
            conversationId,

            containerLabel: 'duix-container'       // note the correct spelling
          });
        } catch (err) {
          console.error(err);
          document.body.textContent = 'duix.init failed: ' + err.message;
        }
      })();
    })();
  </script>